# コードレビュー観点まとめ

## ① 機能性（ロジック・設計の妥当性）

| 観点                 | 具体例                                                                          | 備考                                                                                                                                                                                                                                                                                                                                                                 |
| -------------------- | ------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 仕様適合性           | - 仕様は明確に提示されているか<br>- コードが提示された仕様を満たしているか      |                                                                                                                                                                                                                                                                                                                                                                      |
| エラーハンドリング   | - 外部APIのエラーケースを考慮できているか<br>- エラー時に適切な処理が行われるか |                                                                                                                                                                                                                                                                                                                                                                      |
| 境界値・エッジケース | - データが0件の場合など特殊ケースを考慮しているか                               |                                                                                                                                                                                                                                                                                                                                                                      |
| 冪等性・原子性       | - 途中で処理が中断した場合の再実行可能性が考慮されているか                      | 冪等性があるとエラー時のオペレーションも楽になる。<br> - 例1：テーブルを更新ではなく洗い替えする（create or replace）のであれば、失敗してもただ再実行するだけでOK<br> - 例2：S3上のオブジェクトがあるか確認しある場合は削除するようにしてから実行する作りにする（処理の途中で落ちて再実行したい場合、中途半端な成果物が残っている場合手動削除してから再実行しないといけないのは、オペレーションが複雑化 & 面倒） |
| 他機能への影響       | - 他機能に意図しない影響が出ていないか                                          |                                                                                                                                                                                                                                                                                                                                                                      |
| 型安全性             | - 数値と文字列の混在によるバグが無いか（動的型付け言語の場合）                  | 例えばPythonで数値が入った2つの変数を同一か比較する際に、片方はint, 片方はstringだと、数値自体は同じでも同一という判定にならないバグになりうる                                                                                                                                                                                                                       |
| 日時処理             | - タイムゾーンは問題ないか                                                      | 例えば今日の日付を取るような関数があったとして、タイムゾーン指定しない場合デフォルトUTCになるようなものだと、JSTのAM9時以前に実行すると、昨日の日付が取得されてしまう。AM9時以前に実行して検証したりしていないと、気付きづらい。                                                                                                                                     |
| セキュリティ         | - 入力値のバリデーション（SQLインジェクション、XSS等）が適切か                  |                                                                                                                                                                                                                                                                                                                                                                      |

## ② テスト（品質担保の妥当性）

| 観点                       | 具体例                                                                           | 備考                                                                                 |
| -------------------------- | -------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------ |
| テストケースの妥当性       | - 仕様がテストケースに落とし込まれているか                                       | 特に、間違うと重大事故に繋がりうるような重要な箇所のテストは十分か                   |
| テストコードのわかりやすさ | - テストコード自体が複雑なロジックを持ったりしていないか                         |                                                                                      |
| テスト設計の適切さ         | - プライベートメソッドを直接テストしていないか                                   | テストが脆くなるため基本的にNG                                                       |
| モックの適切性             | - モック範囲が広すぎないか<br>- モック対象は日時や外部依存部分に限定されているか | なるべく多くのコードがテストで実行されるようにすることでリグレッション耐性を高める。 |
| エッジケースのテスト       | - エッジケースのテストは出来ているか                                             |                                                                                      |

## ③ 非機能要件（パフォーマンス・インフラ等）

| 観点                   | 具体例                                                                                                                                  | 備考                                                                                       |
| ---------------------- | --------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------ |
| 性能・パフォーマンス   | - メモリ使用量・計算量に問題がないか。それらに大きな影響を与えるような改修の場合は計測したか<br>- SQLのパフォーマンスに改善余地があるか | SQLはインデックスやパーティショニング、クラスタリングが活かせる書き方になっているのか等。  |
| スケーラビリティ       | - ユーザー数やデータ量の増加に対応できる設計になっているか                                                                              |                                                                                            |
| 環境・インフラ面       | - サーバ環境の前提条件が整っているか                                                                                                    | そのサーバにアプリを動かすのに必要なものは入っているのか、新しいサーバへ接続出来るのかなど |
| クラウド・クォータ制限 | - APIのrate limitやクォータ制限を考慮しているか                                                                                         |                                                                                            |

## ④ 保守性・運用性（可読性・運用・チーム開発のしやすさ）

| 観点                           | 具体例                                                                                                         | 備考                                                                                                                                              |
| ------------------------------ | -------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| レビューしやすさ               | - 仕様や変更意図がレビュアーに提示されているか、理解しやすいか<br>- 出力サンプルがレビュアーに提示されているか |                                                                                                                                                   |
| コードの複雑さ・シンプルさ     | - 必要以上に複雑になっていないか、もっとシンプルに実現出来ないか                                               |                                                                                                                                                   |
| クラス設計・責務分割           | - カプセル化、関心の分離等出来ているか                                                                         | - カプセル化: データとその操作をまとめる <br> - 関心の分離: 無関係なもの同士を混ぜず目的ごとに分離する                                            |
| ロギングの適切性               | - エラー時等原因調査が行いやすいログになっているのか<br>- ログの見え方は問題ないか                             | 実際にログを確認すると長すぎて見づらいとかたまにある                                                                                              |
| コードの可読性                 | - ネストが深すぎないか<br>- サイクロマティック複雑度が高すぎないか                                             | 可読性が悪いとは:<br>- 階層を何度も潜って関数内部を都度見ていったりしないと理解できない<br>- 上から下にコードを流れるように読めない<br>などの状態 |
| コーディングスタイル・統一性   | - 既存スタイルとの統一性                                                                                       |                                                                                                                                                   |
| lint・フォーマット確認         | - lintやフォーマット処理が適用されているか                                                                     |                                                                                                                                                   |
| 命名の適切性                   | - 命名が分かりやすく適切か                                                                                     |                                                                                                                                                   |
| コメント・ドキュメントの妥当性 | - Why・Why notが記載されているか<br>- ドキュメント更新忘れがないか                                             | ドキュメント: JavaDocやdocstring等コードドキュメントのみではなくCHANGELOGやREADME、Confluence等も含む                                             |
| typoや表記ミスの確認           | - スペルミスがないか                                                                                           |                                                                                                                                                   |
| コミットメッセージの適切性     | - コミット粒度やメッセージが明確か                                                                             |                                                                                                                                                   |
| 依存モジュールの更新管理       | - submoduleが適切に更新されているか                                                                            |                                                                                                                                                   |

## ⑤ 運用・リリース面の注意事項

| 観点                         | 具体例                                                                           | 備考                                                                                                                                                                                                                                      |
| ---------------------------- | -------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ロールバック・リカバリー手順 | - 問題発生時のロールバック・リカバリー手順が明確に定義されているか               |                                                                                                                                                                                                                                           |
| モニタリング・アラート設計   | - 新機能や変更箇所のモニタリング方法やアラート基準が明確になっているか           |                                                                                                                                                                                                                                           |
| リリース管理の妥当性         | - developブランチにリリースしたくない差分が入っていないか                        | git-flowのdevelopブランチにあたる場所にリリースしたくないものが入りこんでいると事故リスクが高まる(featureブランチをdevelopにマージ後にリリース保留となったがrevert等が行われず、気付かずにそのまま他の対応のリリースに含まれてしまうなど) |
| ファイルサイズ変更の確認     | - ファイルサイズが大きく変わるような改修の場合は実測サイズやその影響は確認済みか |                                                                                                                                                                                                                                           |
